-- UserID, FirstName, LastName, Phone, Email, Password
CREATE TABLE IF NOT EXISTS Users (
   UserID INT UNSIGNED AUTO_INCREMENT,
   FirstName VARCHAR(255) NOT NULL,
   LastName VARCHAR(255) NOT NULL,
   Phone VARCHAR(255) NOT NULL UNIQUE,
   Email VARCHAR(255) NOT NULL UNIQUE,
   Pass VARCHAR(255) NOT NULL,
   PRIMARY KEY(UserID)
);

-- UserID, Avatar, RegDate
CREATE TABLE IF NOT EXISTS Profiles (
   UserID INT UNSIGNED,
   Avatar VARCHAR(255),
   RegDate DATE,
   PRIMARY KEY(UserID),
   FOREIGN KEY(UserID) REFERENCES Users(UserID)
   ON DELETE CASCADE
);

-- ListingID, ImageID, UserID, TimePosted, Status
CREATE TABLE IF NOT EXISTS Listings (
	ListingID INT UNSIGNED AUTO_INCREMENT,
	UserID INT UNSIGNED,
	TimePosted TIMESTAMP,
	Status BIT(1),
	PRIMARY KEY(ListingID)
	FOREIGN KEY(UserID) REFERENCES Users(UserID)
	ON DELETE CASCADE
);

-- ImageID, Size, Type
CREATE TABLE IF NOT EXISTS ListingImage (
   ListingID INT UNSIGNED PRIMARY KEY,
   ImageSrc VARCHAR(255) NOT NULL,
   FOREIGN KEY(ListingID) REFERENCES Listings(ListingID)
   ON DELETE CASCADE
);

-- ListingID, ISBN, Condition, Price .................................
CREATE TABLE IF NOT EXISTS Product (
	ISBN VARCHAR(255),
	ListingID INT UNSIGNED NOT NULL,
	Cond INT UNSIGNED NOT NULL,
	Price DECIMAL UNSIGNED NOT NULL,
	PRIMARY KEY(ListingID),
	FOREIGN KEY(ListingID) REFERENCES Listings(ListingID),
	FOREIGN KEY(ISBN) REFERENCES Books(ISBN)
	ON DELETE CASCADE
);

-- TransactionID, BuyerID, SellerID, ListingID, TimeCompleted
CREATE TABLE IF NOT EXISTS AuditLog (
   TransID INT UNSIGNED AUTO_INCREMENT,
   ListingID INT UNSIGNED,
   SellerID INT UNSIGNED NOT NULL,
   BuyerID INT UNSIGNED NOT NULL,
   TimeComplete TIMESTAMP NOT NULL,
   PRIMARY KEY(TransID, ListingID)
);

--ISBN Title Author
CREATE TABLE IF NOT EXISTS Books (
   ISBN VARCHAR(255),
   Title VARCHAR(255) NOT NULL,
   Author VARCHAR(255),
   PRIMARY KEY(ISBN)
);
